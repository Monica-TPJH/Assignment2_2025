import pygame
import pandas as pd
import math
import random

WIDTH, HEIGHT = 800, 800
FPS = 60

# Load tidal data (now using the sample CSV in this folder)
data = pd.read_csv('sample_tidal_data.csv')
tide_heights = data['height'].values if 'height' in data.columns else [1]*24


pygame.init()
screen = pygame.display.set_mode((WIDTH, HEIGHT))
clock = pygame.time.Clock()

# Generate random background stars
NUM_BG_STARS = 200
bg_stars = [
    (random.randint(0, WIDTH-1), random.randint(0, HEIGHT-1), random.randint(1, 3))
    for _ in range(NUM_BG_STARS)
]

running = True
frame = 0
while running:
    for event in pygame.event.get():
        if event.type == pygame.QUIT:
            running = False
    screen.fill((10, 10, 30))
    # Draw background stars
    for sx, sy, sz in bg_stars:
        pygame.draw.circle(screen, (255, 255, 255), (sx, sy), sz)
    cx, cy = WIDTH//2, HEIGHT//2
    n_points = len(tide_heights)
    # Draw a star: lines radiating from center, endpoints modulated by tidal data
    points = []
    step = 1  # Show every star for maximum density
    for i in range(0, n_points, step):
        angle = 2 * math.pi * i / n_points + frame * 0.01
        radius = 200 + tide_heights[i] * 60
        x = int(cx + radius * math.cos(angle))
        y = int(cy + radius * math.sin(angle))
        points.append((x, y))
    n_points = len(points)
    # Draw lines from center to each point (star rays)
    def draw_wavy_star(surface, color, pos, size, frame, waviness=0.4, waves=5):
        # Draw a wavy, irregular star at pos with given size
        cx, cy = pos
        points = []
        num_points = 20
        for j in range(num_points):
            angle = math.pi/2 + j * 2 * math.pi / num_points
            # Wavy modulation
            wave = 1 + waviness * math.sin(waves * angle + frame * 0.07 + cx * 0.01 + cy * 0.01)
            r = size * (1.0 if j % 2 == 0 else 0.5) * wave
            px = cx + r * math.cos(angle)
            py = cy - r * math.sin(angle)
            points.append((px, py))
        pygame.draw.polygon(surface, color, points)

    for i, (x, y) in enumerate(points):
        # Yellow to orange gradient for points
        t = i / n_points
        r = int(255)
        g = int(200 + 55 * (1 - t))  # 255 to 200
        b = int(0 + 80 * t)          # 0 to 80
        color = (r, g, b)
        draw_wavy_star(screen, color, (x, y), 12, frame, waviness=0.5, waves=7)
    pygame.display.flip()
    frame += 1
    clock.tick(FPS)
pygame.quit()
